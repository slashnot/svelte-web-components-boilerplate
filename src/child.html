<div>
	<h2>{$name}</h2>
	<button on:click="getPosts()">Get Posts</button>
	<slot></slot>
	<!-- <svelte:component this="{TextField}" resid="thing" /> -->
</div>


<script>
  import store from "./store";
  import TextField from "./TextField.html";

  export default {
    tag: "app-child",

    store: () => store,

    data() {
      return {
        id: "",
        elm: null,
        TextField
      };
    },

    oncreate() {
      this.set({ id: this.children[0].getAttribute("resid") });
      this.set({ elm: this.children[1] });

      var temp = this.children[1];
      this.store.on('posts', (val)=>{
        val.map(post => {
          var clon = temp.content.cloneNode(true);
          var tmpl = (clon.querySelector("h2").innerText = post[this.children[0].getAttribute("resid")]);
          return document.body.appendChild(clon);
        });
      })
    },

    onupdate() {},

    methods: {
      getPosts() {
        fetch("https://jsonplaceholder.typicode.com/posts")
          .then(res => res.json())
          .then(posts => {
            console.log(posts);
            this.store.set({ posts });
            this.store.fire("posts", posts);
          });
      }
    }
  };
</script>